---
layout: page
group: core
level: 1
title: 11.5 Asynchronous Operations
---

The previous method can be made asynchronous. This MUST be reflected in the
schema as follows:

<pre>&nbsp; &lt;xs:element name="productComputeSimplePrice" 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type="tns:productComputeSimplePrice"
              sme:role="serviceOperation"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **sme:invocationMode="async"** /&gt;</pre>

The <tt>POST</tt> request takes an additional <tt>trackingID</tt> parameter
in this case. This parameter MUST be set to a universally unique identifier
(UUID) that has been generated by the consumer:

<pre>POST /sdata/myApp/myContract/-/products/$service/computeSimplePrice?trackingID=abc42b0d-d110-4f5c-ac79-d3aa11bd20cb </pre>

<blockquote class="note">If the operation is available both in synchronous and
asynchronous modes (<tt>sme:invocationMode="syncOrAsync"</tt>), the presence or
absence of a <tt>trackingID</tt> parameter is used to indicated which mode is
requested by the consumer. If <tt>trackingID</tt> is present, the consumer
expects the operation to be processed asynchronously.</blockquote>

The response is very different this time:

<pre>202 Accepted
Location: http://www.example.com/sdata/myApp/myContract/-/products/$service/computeSimplePrice('abc42b0d-d110-4f5c-ac79-d3aa11bd20cb')
Content-Type: application/xml
&nbsp;
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;tracking xmlns="http://schemas.sage.com/sdata/2008/1"&gt;
&nbsp;&nbsp;&lt;phase&gt;Initialization&lt;/phase&gt;
&nbsp;&nbsp;&lt;phaseDetail&gt;Starting thread&lt;/phaseDetail&gt;
&nbsp;&nbsp;&lt;progress&gt;0.0&lt;/progress&gt;
&nbsp;&nbsp;&lt;elapsedSeconds&gt;0&lt;/elapsedSeconds&gt;
&nbsp;&nbsp;&lt;remainingSeconds&gt;7&lt;/remainingSeconds&gt;
  &lt;pollingMillis&gt;500&lt;/pollingMillis&gt;
&lt;/tracking&gt;</pre>

The <tt>Accepted</tt> status code indicates that the server has accepted the
request and that it is processing it asynchronously.

The <tt>Location</tt> header is the URL that the consumer MUST use to track
the progress of the operation. Usually, the provider&nbsp;uses the tracking id passed
in the <tt>POST</tt> request to identify the operation (as in the example), but
it can also use an internal id. The consumer MUST NOT build the tracking URL
itself, it MUST use the value returned by the provider through the
<tt>Location</tt> header.

The[ <tt>sdata: tracking</tt> payload](../0311/ "3.11 Tracking Payload")
indicates the progress in the operation. If the consumer is an interactive
application, it MAY test the estimated remaining time to decide whether or not
it should display a progress bar.&nbsp;For example, it may decide to show it only if
the operation takes more than 5 seconds and only display an hourglass cursor
otherwise.

The consumer SHOULD track the progress of the application by sending a
<tt>GET</tt> request on the tracking URL:

<pre>GET http://www.example.com/sdata/myApp/myContract/-/products/$service/computeSimplePrice('abc42b0d-d110-4f5c-ac79-d3aa11bd20cb') </pre>

If the operation is&nbsp;in progress, the service provider MUST send a response
such as:

<pre>202 Accepted
Location: http://www.example.com/myApp/myContract/-/products/$service/computeSimplePrice('abc42b0d-d110-4f5c-ac79-d3aa11bd20cb')
Content-Type: application/xml
&nbsp;
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;sdata:tracking xmlns:sdata="http://schemas.sage.com/sdata/2008/1"&gt;
&nbsp; &lt;sdata:phase&gt;Computing price&lt;/sdata:phase&gt;
&nbsp; &lt;sdata:phaseDetail&gt;Loading tariffs&lt;/sdata:phaseDetail&gt;
&nbsp; &lt;sdata:progress&gt;20.0&lt;/sdata:progress&gt;
&nbsp; &lt;sdata:elapsedSeconds&gt;2&lt;/sdata:elapsedSeconds&gt;
&nbsp; &lt;sdata:remainingSeconds&gt;6&lt;/sdata:remainingSeconds&gt;
&lt;/sdata:tracking&gt;</pre>

<blockquote class="note">The <tt>elapsedSeconds</tt> value SHOULD increase between calls.
Whereas the <tt>progress</tt> value MAY NOT always increase and the
<tt>remainingSeconds</tt> value MAY NOT always decrease because the service may
adjust its estimates as the operation progresses.</blockquote>

When the operation is complete, the service provider&nbsp;sends the result with an
<tt>OK</tt> status:

<pre>200 OK
Content-Type: application/atom+xml; type=entry
&nbsp;
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;entry xmlns="http://www.w3.org/2005/Atom"&gt;
&nbsp; &lt;id&gt;http://www.example.com/sdata/myApp/myContract/-/products/$service/computeSimplePrice?productId=P049&amp;amp;customerID=C027&amp;amp;quantity=5&lt;/id&gt;
&nbsp; &lt;title type="text"&gt;computeSimplePrice?productId=P049&amp;customerID=C027&amp;quantity=5&lt;/title&gt;
&nbsp; &lt;updated&gt;2008-03-31T14:52:28Z&lt;/updated&gt;
  &lt;sdata:payload&gt;
&nbsp;   &lt;productComputeSimplePrice xmlns="http://schemas.sage.com/myContract"&gt;
  &nbsp;&nbsp;&nbsp; &lt;response&gt;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;unitPrice&gt;120.0&lt;/unitPrice&gt;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;quantityPrice&gt;600.0&lt;/quantityPrice&gt;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;discount&gt;0.0&lt;/discount&gt;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tax&gt;33.0&lt;/tax&gt;
  &nbsp;&nbsp;&nbsp; &lt;/response&gt;
  &nbsp; &lt;/productComputeSimplePrice&gt;&nbsp; 
  &lt;/sdata:payload&gt;
&lt;/entry&gt;</pre>

At this point, the provider side MUST NOT delete the&nbsp;context in which
the&nbsp;operation started because the consumer is allowed to <tt>GET</tt> the result
more than once (and the semantics of a <tt>GET</tt> operation do not allow
side-effects). The consumer is responsible for the clean-up. It MUST terminate
the operation by sending a <tt>DELETE</tt> request on the operation URL:

<pre>DELETE http://www.example.com/myApp/myContract/-/products/$service/computeSimplePrice('abc42b0d-d110-4f5c-ac79-d3aa11bd20cb') </pre>

At this point, the service provider MUST delete the&nbsp;context in which the
operation started and return an <tt>OK</tt> status:

<pre>200 OK</pre>

<blockquote class="note">The provider MAY choose to respond synchronously rather than
asynchronously to an asynchronous request. In this case the provider will
respond to the initial POST request with a <tt>200 OK</tt> response if the
request is successful. The calling logic on the consumer side MUST be set up to
handle this case. If the initial POST returns a status different from 202, the
caller MUST consider that the call has been processed synchronously and it
should skip the asynchronous steps described above (GET to track progress and
DELETE at the end).</blockquote>

<blockquote class="compliance">SData providers and consumers MUST use the above protocol to
invoke service operations asynchronously.</blockquote>

* * *